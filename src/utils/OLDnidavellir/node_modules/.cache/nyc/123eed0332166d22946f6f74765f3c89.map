{"version":3,"file":"tests.cjs.js","sources":["../src/utils/jsonSearch.js","../test/utils/fixtures/jsonSearch.js","../test/utils/jsonSearch.js"],"sourcesContent":["// @flow\n// TODOS:\n\n// 2. Add the option to pass in 'keyToReturn'\n// 3. Extend JsonSearchParams to allow for multiple options by passing in arrays\n\nimport {\n  type JsonSearchParams,\n  type RecursiveSearchParams\n} from '../../types/utils'\n\nexport const search = (query: JsonSearchParams, jsonObj: any): Array<any> => {\n  // If nothing was requested, return the current object\n  if (!query.keyToMatch) return [jsonObj]\n\n  // Tokenize the search terms\n  const tokenizeKeys = query.keyToMatch.split('.')\n\n  // Add either wild card at the begining unless told not too or it's already there\n  if (tokenizeKeys[0] === '$') tokenizeKeys.shift()\n\n  // Call the recursive search\n  const result = searchRec({\n    valueToMatch: query.valueToMatch,\n    tokenizeKeys,\n    parent: jsonObj,\n    limit: query.limit || Infinity,\n    results: []\n  }, jsonObj)\n  return result\n}\n\nconst searchRec = (query: RecursiveSearchParams, jsonObj: any): Array<any> => {\n  // If jsonObj is undefined or we have enough results we can return\n  if (\n    typeof jsonObj === 'undefined' ||\n    query.results.length >= query.limit\n  ) return query.results\n\n  const { valueToMatch, parent } = query\n  // Move the parent pointer\n  query.parent = jsonObj\n\n  // Going over each Array child with the same query params\n  if (Array.isArray(jsonObj)) {\n    for (const child of jsonObj) {\n      searchRec({ ...query }, child)\n    }\n  } else if (\n    // If we ran out of tokenizeKeys it means we need to verify\n    // that we found the right key with the correct value and if so add the parent to the results list\n    !query.tokenizeKeys.length\n  ) {\n    if (valueToMatch === undefined) query.results.push(jsonObj)\n    if (valueToMatch === jsonObj) query.results.push(parent)\n  } else if (typeof jsonObj === 'object') {\n    // Get a mutable version of tokenizeKeys\n    let { tokenizeKeys } = query\n\n    // If not token, decent into all children and remove the wildcard after\n    if (tokenizeKeys[0] === '') {\n      for (const key in jsonObj) {\n        searchRec({ ...query }, jsonObj[key])\n      }\n      tokenizeKeys = tokenizeKeys.slice(1)\n    }\n\n    // Decent into child based on the first key in tokenizeKeys with jsonObj as the parent\n    const childKey = tokenizeKeys[0]\n    tokenizeKeys = tokenizeKeys.slice(1)\n    searchRec({ ...query, tokenizeKeys }, jsonObj[childKey])\n  }\n\n  return query.results\n}\n","export const jsonObj = {\n  alpha: 1,\n  bravo: [1, 2, 3],\n  charlie: { delta: 1 },\n  india: {\n    kilo: 4,\n    lima: 4\n  },\n  uniform: {\n    kilo: 4,\n    lima: 4\n  },\n  echo: {\n    foxtrot: [1, 2, 3],\n    golf: {\n      india: {\n        kilo: 4,\n        lima: 4\n      },\n      juliet: {\n        kilo: 4,\n        lima: 5\n      },\n      mike: [\n        { kilo: 4 },\n        6,\n        { lima: 5 },\n        { lima: 6, kilo: 7 },\n        { charlie: { delta: 1 } },\n        { alpha: 1 },\n        [ 6, { lima: 5 }, 10 ]\n      ],\n      november: 8\n    }\n  }\n}\n\nexport const fixtures = [\n  [ [], [jsonObj] ],\n\n  [ ['$.charlie.delta', 1], [\n    jsonObj['charlie']\n  ] ],\n\n  [ ['charlie.delta', 1], [\n    jsonObj['charlie']\n  ] ],\n\n  [ ['echo.golf.india.kilo', 4], [\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['$..alpha', 1], [\n    jsonObj['echo']['golf']['mike'][5],\n    jsonObj\n  ] ],\n\n  [ ['$..alpha', 2], [] ],\n\n  [ ['$..charlie', 1], [] ],\n\n  [ ['$..delta', 1], [\n    jsonObj['charlie'],\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n\n  [ ['$..charlie.delta', 1], [\n    jsonObj['charlie'],\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n\n  [ ['$..india.kilo', 5], [] ],\n\n  [ ['$..india.lima', 5], [] ],\n\n  [ ['$..echo.golf.india.kilo', 4], [jsonObj['echo']['golf']['india']] ],\n\n  [ ['$..echo.golf.india.kilo', 5], [] ],\n\n  [ ['$..echo.golf.november', 8], [jsonObj['echo']['golf']] ],\n\n  [ ['$..india.kilo', 4], [\n    jsonObj['india'],\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['$..lima', 5], [\n    jsonObj['echo']['golf']['juliet'],\n    jsonObj['echo']['golf']['mike'][2],\n    jsonObj['echo']['golf']['mike'][6][1]\n  ] ],\n\n  [ ['$..lima', 4], [\n    jsonObj['india'],\n    jsonObj['uniform'],\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['$..kilo', 4], [\n    jsonObj['india'],\n    jsonObj['uniform'],\n    jsonObj['echo']['golf']['india'],\n    jsonObj['echo']['golf']['juliet'],\n    jsonObj['echo']['golf']['mike'][0]\n  ] ],\n\n  [ ['$..golf..delta', 1], [\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n\n  [ ['$..mike..delta', 1], [\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n\n  [ ['$..echo.foxtrot', 2], [\n    jsonObj['echo']['foxtrot']\n  ] ],\n\n  [ ['$..bravo', 0], [] ],\n\n  [ ['$..bravo', 1], [jsonObj['bravo']] ],\n\n  [ ['$..charlie'], [\n    jsonObj['echo']['golf']['mike'][4]['charlie'],\n    jsonObj['charlie']\n  ] ]\n\n  // [ ['$..bravo'], [\n  //   jsonObj['bravo']\n  // ] ],\n\n  // [ ['bravo'], [\n  //   jsonObj['bravo']\n  // ] ],\n\n  // [ ['$.bravo'], [\n  //   jsonObj['bravo']\n  // ] ]\n\n  // [ ['lima'], [\n  //   4\n  //   4\n  //   4\n  //   5\n  //   5\n  //   6\n  //   5\n  //   jsonObj['charlie'],\n  //   jsonObj['echo']['golf']['mike'][4]['charlie']\n  // ] ]\n\n]\n","// @flow\n\nimport { assert } from 'chai'\nimport { describe, it } from 'mocha'\n\nimport { search } from '../../src/utils/jsonSearch.js'\nimport { fixtures, jsonObj } from './fixtures/jsonSearch.js'\n\ndescribe('Testing Json Search', function () {\n  fixtures.forEach(([ test, expected ]) => {\n    it(`Testing search with: ${JSON.stringify(test)} and no limit`, function () {\n      const searchParams = {\n        keyToMatch: test[0],\n        valueToMatch: test[1]\n      }\n      const results = search(searchParams, jsonObj)\n      assert.deepEqual(results, expected)\n    })\n\n    for (let i = 1; i <= expected.length; i++) {\n      it(`Testing search with: ${JSON.stringify(test)} and limit ${i}`, function () {\n        const searchParams = {\n          keyToMatch: test[0],\n          valueToMatch: test[1],\n          limit: i\n        }\n        const results = search(searchParams, jsonObj)\n        console.log('expected', expected)\n        console.log('results', results)\n        assert.deepEqual(results, expected.slice(0, i))\n      })\n    }\n  })\n})\n"],"names":["search","query","jsonObj","keyToMatch","tokenizeKeys","split","shift","result","searchRec","valueToMatch","parent","limit","Infinity","results","length","Array","isArray","child","undefined","push","key","slice","childKey","alpha","bravo","charlie","delta","india","kilo","lima","uniform","echo","foxtrot","golf","juliet","mike","november","fixtures","describe","forEach","test","expected","it","JSON","stringify","searchParams","assert","deepEqual","i","console","log"],"mappings":"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"}