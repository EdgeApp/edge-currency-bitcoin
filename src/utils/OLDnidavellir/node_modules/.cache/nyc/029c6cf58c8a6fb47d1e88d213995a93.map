{"version":3,"file":"tests.cjs.js","sources":["../src/utils/jsonSearch.js","../test/utils/fixtures/jsonSearch.js","../test/utils/jsonSearch.js"],"sourcesContent":["// @flow\n// TODOS:\n// 1. Add * as Wild card\n// 2. Add the option to pass in 'keyToReturn'\n// 3. Extend JsonSearchParams to allow for multiple options by passing in arrays\n\nimport {\n  type JsonSearchParams,\n  type RecursiveSearchParams\n} from '../../types/utils'\nimport { appendFileSync } from 'fs'\n\nlet counter = 0\n// const counterObj = {\n//   end: 0,\n//   wild: 0,\n//   array: 0,\n//   object: 0\n// }\nlet totalCount = 0\nlet start = true\nconst version = 1\n\nexport const search = (query: JsonSearchParams, jsonObj: any): Array<any> => {\n  // If nothing was requested, return the current object\n  if (!query.keyToMatch) return [jsonObj]\n\n  // Tokenize the search terms\n  const tokenizeKeys = query.keyToMatch.split('.')\n\n  // Add wild card at the begining unless told not too or it already exists\n  if (tokenizeKeys[0] !== '*' || tokenizeKeys[0] !== '!') {\n    tokenizeKeys.unshift('*')\n  }\n\n  // Call the recursive search\n  const result = searchRec({\n    valueToMatch: query.valueToMatch,\n    tokenizeKeys,\n    parent: jsonObj,\n    tokensUsed: false,\n    count: query.count || Infinity,\n    results: []\n  }, jsonObj)\n\n  totalCount += counter\n  let data = `Total Ticks: ${totalCount}\\n`\n  if (start) {\n    data = `\\n\\nVersion: ${version}\\n------------------------\\n` + data\n    start = false\n  }\n  appendFileSync('./benchmarks.txt', data)\n\n  counter = 0\n  return result\n}\n\nconst searchRec = (query: RecursiveSearchParams, jsonObj: any): Array<any> => {\n  counter++\n  // If jsonObj is undefined we can't compare anything and so we fail early\n  if (typeof jsonObj === 'undefined') return []\n  // If we have enough results we can return\n  if (query.results.length >= query.count) return query.results\n\n  const { valueToMatch } = query\n  const { tokensUsed } = query\n  // If we ran out of tokenizeKeys it means we need to verify\n  // that we found the right key with the correct value and if so add the parent to the results list\n  if (\n    !query.tokenizeKeys.length &&\n    (typeof valueToMatch === 'undefined' || valueToMatch === jsonObj)\n  ) {\n    // counterObj.end++\n    query.results.push(query.parent)\n  } else {\n    // Move the head pointer to myself\n    query.parent = jsonObj\n    query.tokensUsed = true\n\n    // If we are searching in an Array, we would go over each child without moving the token counter\n    if (Array.isArray(jsonObj)) {\n      // counterObj.array++\n      for (const child of jsonObj) {\n        searchRec({ ...query }, child)\n      }\n    } else if (typeof jsonObj === 'object') {\n      // console.log('tokenizeKeys[0]', tokenizeKeys[0])\n      // console.log('query', query)\n      // console.log('jsonObj', jsonObj)\n      // If there no tokens was used, it means that we still have the full tokenizeKeys\n      // So we will try to use the same tokenizeKeys for every child of jsonObj\n      // if (!tokensUsed) {\n      //   // counterObj.wild++\n      //   for (const key in jsonObj) {\n      //     console.log('tokensUsed key', key)\n      //     searchRec({ ...query, tokensUsed }, jsonObj[key])\n      //   }\n      // }\n\n      let tokens = query.tokenizeKeys\n\n      if (tokens[0] === '*') {\n        // counterObj.wild++\n        for (const key in jsonObj) {\n          // console.log('wild key', key)\n          searchRec({ ...query }, jsonObj[key])\n        }\n        // searchRec({ ...query, tokenizeKeys: tokens.slice(1) }, jsonObj)\n        tokens = tokens.slice(1)\n      }\n      // counterObj.object++\n      // Shift one level based on the first key in tokenizeKeys with jsonObj as the parent\n      searchRec({\n        ...query,\n        tokenizeKeys: tokens.slice(1)\n      }, jsonObj[tokens[0]])\n    }\n  }\n  // console.log(query.results)\n  return query.results\n}\n","export const jsonObj = {\n  alpha: 1,\n  bravo: [1, 2, 3],\n  charlie: { delta: 1 },\n  india: {\n    kilo: 4,\n    lima: 4\n  },\n  uniform: {\n    kilo: 4,\n    lima: 4\n  },\n  echo: {\n    foxtrot: [1, 2, 3],\n    golf: {\n      india: {\n        kilo: 4,\n        lima: 4\n      },\n      juliet: {\n        kilo: 4,\n        lima: 5\n      },\n      mike: [\n        { kilo: 4 },\n        6,\n        { lima: 5 },\n        { lima: 6, kilo: 7 },\n        { charlie: { delta: 1 } },\n        { alpha: 1 },\n        [ 6, { lima: 5 }, 10 ]\n      ],\n      november: 8\n    }\n  }\n}\n\nexport const fixtures = [\n  [ [], [jsonObj] ],\n  [ ['alpha', 1], [\n    jsonObj['echo']['golf']['mike'][5],\n    jsonObj\n  ] ],\n  [ ['alpha', 2], [] ],\n  [ ['bravo', 0], [] ],\n  [ ['bravo', 1], [jsonObj['bravo']] ],\n  [ ['charlie', 1], [] ],\n  [ ['delta', 1], [\n    jsonObj['bravo'],\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n  [ ['charlie.delta', 1], [\n    jsonObj['charlie'],\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n  [ ['india.kilo', 5], [] ],\n  [ ['india.lima', 5], [] ],\n\n  [ ['echo.foxtrot', 2], [\n    jsonObj['echo']['foxtrot']\n  ] ],\n\n  [ ['echo.golf.india.kilo', 4], [jsonObj['echo']['golf']['india']] ],\n  [ ['echo.golf.india.kilo', 5], [] ],\n  [ ['echo.golf.november', 8], [jsonObj['echo']['golf']] ],\n\n  [ ['india.kilo', 4], [\n    jsonObj['india'],\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['lima', 5], [\n    jsonObj['echo']['golf']['juliet'],\n    jsonObj['echo']['golf']['mike'][2],\n    jsonObj['echo']['golf']['mike'][6][1]\n  ] ],\n\n  [ ['lima', 4], [\n    jsonObj['india'],\n    jsonObj['uniform'],\n    jsonObj['echo']['golf']['india']\n  ] ],\n\n  [ ['kilo', 4], [\n    jsonObj['india'],\n    jsonObj['uniform'],\n    jsonObj['echo']['golf']['india'],\n    jsonObj['echo']['golf']['juliet'],\n    jsonObj['echo']['golf']['mike'][0]\n  ] ],\n\n  [ ['golf.*.delta', 1], [\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ],\n\n  [ ['mike.*.delta', 1], [\n    jsonObj['echo']['golf']['mike'][4]['charlie']\n  ] ]\n]\n","// @flow\n\nimport { assert } from 'chai'\nimport { describe, it } from 'mocha'\n\nimport { search } from '../../src/utils/jsonSearch.js'\nimport { fixtures, jsonObj } from './fixtures/jsonSearch.js'\n\ndescribe('Testing Json Search', function () {\n  fixtures.forEach(([ test, expected ]) => {\n    it(`Testing search with: ${JSON.stringify(test)} and no count limit`, function () {\n      const searchParams = {\n        keyToMatch: test[0],\n        valueToMatch: test[1]\n      }\n      const results = search(searchParams, jsonObj)\n      assert.deepEqual(results, expected)\n    })\n\n    for (let i = 1; i <= expected.length; i++) {\n      it(`Testing search with: ${JSON.stringify(test)} and count ${i}`, function () {\n        const searchParams = {\n          keyToMatch: test[0],\n          valueToMatch: test[1],\n          count: i\n        }\n        const results = search(searchParams, jsonObj)\n        console.log('results', results)\n        console.log('expected', expected)\n        assert.deepEqual(results, expected.slice(0, i))\n      })\n    }\n  })\n})\n"],"names":["counter","totalCount","start","version","search","query","jsonObj","keyToMatch","tokenizeKeys","split","unshift","result","searchRec","valueToMatch","parent","tokensUsed","count","Infinity","results","data","appendFileSync","length","push","Array","isArray","child","tokens","key","slice","alpha","bravo","charlie","delta","india","kilo","lima","uniform","echo","foxtrot","golf","juliet","mike","november","fixtures","describe","forEach","test","expected","it","JSON","stringify","searchParams","assert","deepEqual","i","console","log"],"mappings":"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"}